echo               both
dimension          2
units              si
atom_modify        map array sort 0 0
atom_style         meso
comm_modify    vel yes

include         in.box
include         in.lattice
#create_box        1 box
#create_atoms    1   random ${Ntarget} 55555 box
read_data       data/sph.data
mass            1 ${sph_mass}

set             group all meso_rho 1.0
set             group all meso_e   1.0

variable        cutoff     equal 2.5*${dx}

variable        sph_c      equal 10.0
variable        sph_rho    equal 1
variable        sph_eta    equal 0.1
variable        sph_mu     equal ${sph_eta}/${sph_rho}
variable        Nfreq      equal 100
include         settimestep.lmp

# in.bn is generated by gen.awk
include         in.bn
variable        NN           equal 6
variable        ntime_smooth equal -1
pair_style      hybrid/overlay sph/bn/rhosum 1 ${NN} ${bn} ${ntime_smooth} sph/bn ${NN} ${bn} ${ntime_smooth}

pair_coeff	1 1 sph/bn        liq  ${sph_c} ${sph_eta} ${cutoff}
pair_coeff	1 1 sph/bn/rhosum liq  ${cutoff}

compute         rho     all  meso_rho/atom
compute         rho_tg  all  target/field ${bn} ${ntime_smooth}
#variable        rho_de  atom c_rho_tg-c_rho
dump            dump_txt all custom ${Nfreq} dump.*.dat id type x y vx vy fx fy c_rho c_rho_tg
dump_modify     dump_txt first yes sort id pad 8

# do full time integration
variable           max_dr equal 0.1*${dx}
fix                integrate_fix_full all  meso/novel ${max_dr}

neighbor           0 bin
neigh_modify       delay 0 every 1

timestep           ${dt}

fix extra all print ${Nfreq} "$(fx[1]) $(fx[2])" file outpt.dat screen no

dump               dump_xyz all xyz ${Nfreq} data.xyz
dump_modify        dump_xyz element A

variable           drho atom abs(c_rho-c_rho_tg)
compute            drho_max  all reduce max v_drho
thermo_style       custom step c_drho_max

thermo             10

fix                f2d all enforce2d
run                100000
